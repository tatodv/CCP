<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Teatro Centro Cultural Plaza de San Martín - Plano de Asientos
    </title>
    <!-- Actualización de las versiones de React y ReactDOM -->
    <script
      src="https://unpkg.com/react@18/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
      crossorigin
    ></script>
    <!-- Actualización de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Actualización de html2canvas -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
      integrity="sha512-QxYJJfGAAJ5nQ/kv2iK5e6duJxHCcGhwVn2P5TVVhZ6YPY1pBbOKJz4Z1v6g9V0NwqE89LXK52vO4se41YgqFA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- Estilos adicionales para impresión -->
    <style>
      @media print {
        @page {
          size: A4 landscape;
          margin: 1cm;
        }
        body {
          margin: 0;
        }
        /* Control de saltos de página */
        .page-break {
          page-break-before: always;
        }
        /* Ajuste de tamaños para impresión */
        .print-container {
          width: 100%;
          height: auto;
        }
        /* Ocultar botones en impresión */
        .no-print {
          display: none;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <!-- Contenido de la página -->
    <header class="bg-blue-800 text-white p-4">
      <h1 class="text-3xl font-bold text-center">
        Teatro Centro Cultural Plaza de San Martín
      </h1>
    </header>

    <main class="container mx-auto p-4">
      <section class="mb-8">
        <h2 class="text-2xl font-semibold mb-4">Plano de Asientos</h2>
        <p class="text-gray-700 mb-4">
          Seleccione los asientos para ver su disponibilidad. Los asientos en
          rojo están ocupados o seleccionados. Los asientos VIP tienen campos
          para nombre y apellido en la columna derecha.
        </p>
      </section>

      <section id="plano-teatro" class="mb-8"></section>

      <section class="mb-8">
        <h3 class="text-xl font-semibold mb-2">Información del Teatro</h3>
        <p class="text-gray-700">
          El Teatro Centro Cultural Plaza de San Martín es un espacio
          emblemático dedicado a las artes escénicas y la cultura. Ofrecemos una
          variedad de espectáculos que incluyen teatro, danza, música y más.
        </p>
      </section>
    </main>

    <footer class="bg-gray-200 p-4 text-center text-gray-600">
      <p>
        &copy; 2024 Teatro Centro Cultural Plaza de San Martín. Todos los
        derechos reservados.
      </p>
      <p>
        Dirección: [Insertar dirección aquí] | Teléfono: [Insertar teléfono]
      </p>
    </footer>

    <!-- Código JavaScript mejorado -->
    <script type="text/babel">
      const { useState, useRef } = React;

      const Teatro = () => {
        const [asientos, setAsientos] = useState({ PB: {}, PA: {} });
        const [vipNombres, setVipNombres] = useState({ PB: {}, PA: {} });
        const planoRef = useRef(null);

        const secciones = {
          PB: {
            izquierda: {
              filas: 20,
              asientosPorFila: [
                5, 5, 5, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
              ],
            },
            centro: {
              filas: 19,
              asientosPorFila: [
                15, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 15, 16, 15,
                14, 13, 12,
              ],
            },
            derecha: {
              filas: 20,
              asientosPorFila: [
                5, 5, 5, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
              ],
            },
          },
          PA: {
            izquierda: {
              filas: 12,
              asientosPorFila: [10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 5],
            },
            derecha: {
              filas: 12,
              asientosPorFila: [10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 5],
            },
          },
        };

        const toggleAsiento = (planta, seccion, fila, asiento) => {
          setAsientos((prev) => {
            const newAsientos = { ...prev };
            const key = `${seccion}-${fila}-${asiento}`;
            newAsientos[planta][key] = !newAsientos[planta][key];
            return newAsientos;
          });
        };

        const handleVipNombreChange = (planta, fila, asiento, valor) => {
          setVipNombres((prev) => {
            const newVipNombres = { ...prev };
            const key = `${fila}-${asiento}`;
            newVipNombres[planta][key] = valor;
            return newVipNombres;
          });
        };

        const renderSeccion = (planta, nombre, config) => (
          <div className="mx-2" key={`${planta}-${nombre}`}>
            <h3 className="text-lg font-semibold mb-2">{nombre}</h3>
            <div className="flex flex-col items-center">
              {config.asientosPorFila.map((numAsientos, filaIdx) => (
                <div
                  key={filaIdx}
                  className="flex justify-center w-full mb-1 items-center"
                >
                  <span className="mr-2 text-sm">{filaIdx + 1}</span>
                  {Array.from({ length: numAsientos }, (_, asientoIdx) => {
                    const asientoNum =
                      nombre.toLowerCase() === "izquierda"
                        ? numAsientos - asientoIdx
                        : asientoIdx + 1;
                    const key = `${nombre.toLowerCase()}-${
                      filaIdx + 1
                    }-${asientoNum}`;
                    const isSelected = asientos[planta][key];
                    return (
                      <button
                        key={asientoIdx}
                        onClick={() =>
                          toggleAsiento(
                            planta,
                            nombre.toLowerCase(),
                            filaIdx + 1,
                            asientoNum
                          )
                        }
                        className={`w-6 h-6 text-xs rounded-full mx-0.5 flex items-center justify-center ${
                          isSelected
                            ? "bg-red-500 text-white"
                            : "bg-gray-300"
                        }`}
                        aria-label={`Asiento ${asientoNum}, Fila ${
                          filaIdx + 1
                        }, Sección ${nombre}`}
                      >
                        {asientoNum}
                      </button>
                    );
                  })}
                </div>
              ))}
            </div>
          </div>
        );

        const renderVipSection = (planta) => (
          <div className="ml-4 border-l pl-4" key={`vip-${planta}`}>
            <h3 className="text-lg font-semibold mb-2">Asientos VIP</h3>
            <div className="flex space-x-4">
              {Array.from({ length: 2 }, (_, filaIdx) => (
                <div key={filaIdx} className="flex-1">
                  <h4 className="font-semibold mb-2">
                    Fila {filaIdx + 1}
                  </h4>
                  <div className="space-y-2">
                    {Array.from({ length: 10 }, (_, asientoIdx) => {
                      const key = `${filaIdx + 1}-${asientoIdx + 1}`;
                      return (
                        <div key={asientoIdx} className="flex items-center">
                          <span className="mr-2 font-medium w-6">
                            {asientoIdx + 1}:
                          </span>
                          <input
                            type="text"
                            placeholder="Nombre y Apellido"
                            className="flex-grow p-1 text-sm border rounded"
                            value={vipNombres[planta][key] || ""}
                            onChange={(e) =>
                              handleVipNombreChange(
                                planta,
                                filaIdx + 1,
                                asientoIdx + 1,
                                e.target.value
                              )
                            }
                          />
                        </div>
                      );
                    })}
                  </div>
                </div>
              ))}
            </div>
          </div>
        );

        const imprimirPlano = () => {
          window.print();
        };

        const guardarComoJPG = () => {
          html2canvas(planoRef.current, { scale: 2 }).then((canvas) => {
            const link = document.createElement("a");
            link.download = "plano-teatro.jpg";
            link.href = canvas.toDataURL("image/jpeg", 0.95);
            link.click();
          });
        };

        return (
          <div
            ref={planoRef}
            className="max-w-full mx-auto bg-white shadow-lg rounded-lg overflow-hidden p-4 print-container"
          >
            <div className="mb-4 flex justify-end space-x-4 no-print">
              <button
                onClick={imprimirPlano}
                className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
              >
                Imprimir Plano
              </button>
              <button
                onClick={guardarComoJPG}
                className="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
              >
                Guardar como JPG
              </button>
            </div>

            <h2 className="text-2xl font-bold text-center my-4">
              PLANTA BAJA
            </h2>
            <div className="w-full h-8 bg-gray-800 mb-4"></div>
            <div className="flex flex-col lg:flex-row">
              <div className="flex-grow mb-4 lg:mb-0">
                <div className="flex flex-col md:flex-row justify-between">
                  {renderSeccion(
                    "PB",
                    "Izquierda",
                    secciones.PB.izquierda
                  )}
                  {renderSeccion("PB", "Centro", secciones.PB.centro)}
                  {renderSeccion(
                    "PB",
                    "Derecha",
                    secciones.PB.derecha
                  )}
                </div>
                <div className="mt-4 text-center">
                  Cabina de Luces y Sonido
                </div>
              </div>
              {renderVipSection("PB")}
            </div>

            {/* Salto de página para impresión */}
            <div className="page-break"></div>

            <h2 className="text-2xl font-bold text-center my-8">
              PLANTA ALTA
            </h2>
            <div className="w-full h-8 bg-gray-800 mb-4"></div>
            <div className="flex flex-col lg:flex-row justify-center">
              <div className="flex-grow mb-4 lg:mb-0">
                <div className="flex flex-col md:flex-row justify-center space-x-8">
                  {renderSeccion(
                    "PA",
                    "Izquierda",
                    secciones.PA.izquierda
                  )}
                  {renderSeccion(
                    "PA",
                    "Derecha",
                    secciones.PA.derecha
                  )}
                </div>
              </div>
              {renderVipSection("PA")}
            </div>
          </div>
        );
      };

      // Actualización para React 18
      const root = ReactDOM.createRoot(
        document.getElementById("plano-teatro")
      );
      root.render(<Teatro />);
    </script>
  </body>
</html>
